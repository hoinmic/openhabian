// Startup
rule "Startup"
when
  System started
then
  low_tariff.postUpdate("FALSE")
end

// Check low tariff
rule "Low tariff"
when
  Time cron "0 0/1 * * * ?"   // every minute
then
  var Number day = now.getDayOfWeek()
  var Number hour = now.getHourOfDay()

  logInfo("lowTariff", "Weekday: " + day + "Hour: " + hour)

  // Low Tariff EWZ
  if (((day == 1) && ((hour < 7) || (hour > 20))) ||  // Monday
      ((day == 2) && ((hour < 7) || (hour > 20))) ||  // Thuesday
      ((day == 3) && ((hour < 7) || (hour > 20))) ||  // Wednesday
      ((day == 4) && ((hour < 7) || (hour > 20))) ||  // Thursday
      ((day == 5) && ((hour < 7) || (hour > 20))) ||  // Friday
      ((day == 6) && ((hour < 7) || (hour > 13))) ||  // Saturday
      ((day == 7)))                                   // Sunday
    {
      low_tariff.postUpdate("TRUE")
      logInfo("lowTariff", "Low tariff")
    }
    else
    {
      low_tariff.postUpdate("FALSE")
      logInfo("lowTariff", "High tariff")
    }
end